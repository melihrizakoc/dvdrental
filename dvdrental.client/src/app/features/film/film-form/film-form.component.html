<div class="container fade-in-up">
  <!-- Modern Page Header -->
  <div class="page-header d-flex justify-content-between align-items-center">
    <h2><i class="bi bi-film me-2"></i>{{ isEditMode ? 'Film Düzenle' : 'Yeni Film' }}</h2>
    <button type="button" class="btn btn-secondary-custom" [routerLink]="['/films']">
      <i class="bi bi-arrow-left me-2"></i>Geri Dön
    </button>
  </div>

  <!-- Modern Loading Section -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border spinner-border-lg" role="status">
      <span class="visually-hidden">Yükleniyor...</span>
    </div>
    <p class="mt-3 text-muted">{{ isEditMode ? 'Film bilgileri yükleniyor...' : 'İşleminiz gerçekleştiriliyor...' }}</p>
  </div>

  <!-- Modern Error Alert -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
  </div>

  <!-- Modern Form Section -->
  <div class="form-section" *ngIf="!loading">
    <div class="card glassmorphism">
      <div class="card-body">
        <form [formGroup]="filmForm" (ngSubmit)="onSubmit()">
          <!-- Film ID Section -->
          <div class="form-group">
            <label for="film_id" class="form-label">
              <i class="bi bi-hash me-2"></i>Film ID
            </label>
            <div class="input-wrapper">
              <input type="number"
                     class="form-control"
                     id="film_id"
                     formControlName="film_id"
                     [readOnly]="isEditMode"
                     [ngClass]="{ 'is-invalid': submitted && f['film_id'] && f['film_id'].errors, 'readonly-field': isEditMode }"
                     placeholder="Film ID girin">
              <div *ngIf="submitted && f['film_id'] && f['film_id'].errors" class="invalid-feedback">
                <div *ngIf="f['film_id'].errors && f['film_id'].errors['required']">
                  <i class="bi bi-exclamation-circle me-1"></i>Film ID zorunludur
                </div>
                <div *ngIf="f['film_id'].errors && f['film_id'].errors['min']">
                  <i class="bi bi-exclamation-circle me-1"></i>Film ID 1'den küçük olamaz
                </div>
              </div>
              <br />
              <small *ngIf="isEditMode" class="form-text text-muted">
                <i class="bi bi-info-circle me-1"></i>ID değeri güncellenemez
              </small>
            </div>
          </div>

          <!-- Title Section -->
          <div class="form-group">
            <label for="title" class="form-label">
              <i class="bi bi-card-text me-2"></i>Film Adı
            </label>
            <div class="input-wrapper">
              <input type="text"
                     class="form-control"
                     id="title"
                     formControlName="title"
                     [ngClass]="{ 'is-invalid': submitted && f['title'].errors }"
                     placeholder="Film adını girin">
              <div *ngIf="submitted && f['title'].errors" class="invalid-feedback">
                <div *ngIf="f['title'].errors['required']">
                  <i class="bi bi-exclamation-circle me-1"></i>Film adı zorunludur
                </div>
                <div *ngIf="f['title'].errors['maxlength']">
                  <i class="bi bi-exclamation-circle me-1"></i>Film adı 255 karakterden uzun olamaz
                </div>
              </div>
            </div>
          </div>

          <!-- Description Section -->
          <div class="form-group">
            <label for="description" class="form-label">
              <i class="bi bi-file-text me-2"></i>Açıklama
            </label>
            <div class="input-wrapper">
              <textarea class="form-control textarea-custom"
                        id="description"
                        rows="4"
                        formControlName="description"
                        [ngClass]="{ 'is-invalid': submitted && f['description'].errors }"
                        placeholder="Film açıklamasını girin"></textarea>
              <div *ngIf="submitted && f['description'].errors" class="invalid-feedback">
                <div *ngIf="f['description'].errors['maxlength']">
                  <i class="bi bi-exclamation-circle me-1"></i>Açıklama 1000 karakterden uzun olamaz
                </div>
              </div>
            </div>
          </div>

          <!-- Three Column Row -->
          <div class="row g-4">
            <div class="col-md-4">
              <div class="form-group">
                <label for="release_year" class="form-label">
                  <i class="bi bi-calendar me-2"></i>Yayın Yılı
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         class="form-control"
                         id="release_year"
                         formControlName="release_year"
                         [ngClass]="{ 'is-invalid': submitted && f['release_year'].errors }"
                         placeholder="Örn: 2023">
                  <div *ngIf="submitted && f['release_year'].errors" class="invalid-feedback">
                    <div *ngIf="f['release_year'].errors['min']">
                      <i class="bi bi-exclamation-circle me-1"></i>Yayın yılı 1900'den küçük olamaz
                    </div>
                    <div *ngIf="f['release_year'].errors['max']">
                      <i class="bi bi-exclamation-circle me-1"></i>Yayın yılı bugünden ileri olamaz
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label for="language_id" class="form-label">
                  <i class="bi bi-translate me-2"></i>Dil ID
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         class="form-control"
                         id="language_id"
                         formControlName="language_id"
                         [ngClass]="{ 'is-invalid': submitted && f['language_id'].errors }"
                         placeholder="Dil ID">
                  <div *ngIf="submitted && f['language_id'].errors" class="invalid-feedback">
                    <div *ngIf="f['language_id'].errors['required']">
                      <i class="bi bi-exclamation-circle me-1"></i>Dil ID zorunludur
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label for="length" class="form-label">
                  <i class="bi bi-clock me-2"></i>Süre (dakika)
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         class="form-control"
                         id="length"
                         formControlName="length"
                         [ngClass]="{ 'is-invalid': submitted && f['length'].errors }"
                         placeholder="Örn: 120">
                  <div *ngIf="submitted && f['length'].errors" class="invalid-feedback">
                    <div *ngIf="f['length'].errors['min']">
                      <i class="bi bi-exclamation-circle me-1"></i>Süre 1'den küçük olamaz
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Financial Info Row -->
          <div class="row g-4">
            <div class="col-md-4">
              <div class="form-group">
                <label for="rental_duration" class="form-label">
                  <i class="bi bi-calendar-date me-2"></i>Kiralama Süresi (gün)
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         class="form-control"
                         id="rental_duration"
                         formControlName="rental_duration"
                         [ngClass]="{ 'is-invalid': submitted && f['rental_duration'].errors }"
                         placeholder="Örn: 3">
                  <div *ngIf="submitted && f['rental_duration'].errors" class="invalid-feedback">
                    <div *ngIf="f['rental_duration'].errors['required']">
                      <i class="bi bi-exclamation-circle me-1"></i>Kiralama süresi zorunludur
                    </div>
                    <div *ngIf="f['rental_duration'].errors['min']">
                      <i class="bi bi-exclamation-circle me-1"></i>Kiralama süresi 1'den küçük olamaz
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label for="rental_rate" class="form-label">
                  <i class="bi bi-currency-dollar me-2"></i>Kiralama Ücreti
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         step="0.01"
                         class="form-control"
                         id="rental_rate"
                         formControlName="rental_rate"
                         [ngClass]="{ 'is-invalid': submitted && f['rental_rate'].errors }"
                         placeholder="Örn: 4.99">
                  <div *ngIf="submitted && f['rental_rate'].errors" class="invalid-feedback">
                    <div *ngIf="f['rental_rate'].errors['required']">
                      <i class="bi bi-exclamation-circle me-1"></i>Kiralama ücreti zorunludur
                    </div>
                    <div *ngIf="f['rental_rate'].errors['min']">
                      <i class="bi bi-exclamation-circle me-1"></i>Kiralama ücreti 0'dan küçük olamaz
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-group">
                <label for="replacement_cost" class="form-label">
                  <i class="bi bi-cash-stack me-2"></i>Değiştirme Maliyeti
                </label>
                <div class="input-wrapper">
                  <input type="number"
                         step="0.01"
                         class="form-control"
                         id="replacement_cost"
                         formControlName="replacement_cost"
                         [ngClass]="{ 'is-invalid': submitted && f['replacement_cost'].errors }"
                         placeholder="Örn: 19.99">
                  <div *ngIf="submitted && f['replacement_cost'].errors" class="invalid-feedback">
                    <div *ngIf="f['replacement_cost'].errors['required']">
                      <i class="bi bi-exclamation-circle me-1"></i>Değiştirme maliyeti zorunludur
                    </div>
                    <div *ngIf="f['replacement_cost'].errors['min']">
                      <i class="bi bi-exclamation-circle me-1"></i>Değiştirme maliyeti 0'dan küçük olamaz
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Rating Section -->
          <div class="form-group">
            <label for="rating" class="form-label">
              <i class="bi bi-star me-2"></i>Sınıflandırma
            </label>
            <div class="input-wrapper">
              <select class="form-select"
                      id="rating"
                      formControlName="rating"
                      [ngClass]="{ 'is-invalid': submitted && f['rating'].errors }">
                <option value="" disabled>Sınıflandırma seçin</option>
                <option *ngFor="let rating of ratingOptions" [value]="rating">{{ rating }}</option>
              </select>
              <div *ngIf="submitted && f['rating'].errors" class="invalid-feedback">
                <div *ngIf="f['rating'].errors['required']">
                  <i class="bi bi-exclamation-circle me-1"></i>Sınıflandırma zorunludur
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons d-flex gap-3 justify-content-end">
            <button type="button" class="btn btn-secondary-custom" [routerLink]="['/films']" [disabled]="loading">
              <i class="bi bi-x-circle me-2"></i>İptal
            </button>
            <button type="submit" class="btn btn-primary-custom" [disabled]="loading || filmForm.invalid">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-2" role="status"></span>
              <i *ngIf="!loading" [class]="isEditMode ? 'bi bi-check-circle me-2' : 'bi bi-plus-circle me-2'"></i>
              {{ isEditMode ? 'Güncelle' : 'Kaydet' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
